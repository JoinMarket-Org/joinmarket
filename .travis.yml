language: python
python:
 - "2.7_with_system_site_packages"
before_install:
 - sudo apt-add-repository ppa:bitcoin/bitcoin -y
 - sudo apt-get update -q
 - sudo apt-get install --no-install-recommends --no-upgrade -qq bitcoind
 - sudo apt-get install -y build-essential 
 - sudo apt-get install -y automake
 - sudo apt-get install -y libgmp-dev
install:
 - pip install pexpect
 - pip install cffi
script:
#libsodium installation
 - git clone git://github.com/jedisct1/libsodium.git
 - cd libsodium
 - git checkout tags/1.0.3
 - ./autogen.sh
 - ./configure
 - make check
 - sudo make install
 - cd ..
#secp256k1 installation
 - git clone git://github.com/bitcoin/secp256k1.git
 - cd secp256k1
 - ./autogen.sh
 - ./configure --enable-module-ecdh --enable-module-schnorr --enable-module-recovery
 - make
 - ./tests
 - sudo make install
 - cd ..
 - sudo ldconfig
#set up joinmarket.cfg
 - cp test/regtest_joinmarket.cfg joinmarket.cfg
#set up the python bindings for secp256k1
 - cd lib/bitcoin
 - python build.py
 - python noncefunc_build.py
 - cd ../..
#E2E encryption (libnacl) tests
 - python lib/enc_wrapper.py
#start bitcoin regtest daemon and 101 blocks
 - mkdir /home/travis/.bitcoin
 - cp test/bitcoin.conf /home/travis/.bitcoin/.
 - chmod 600 /home/travis/.bitcoin/bitcoin.conf
 - bitcoind -regtest -daemon 
 - sleep 5
 - bitcoin-cli -regtest setgenerate true 101
 - cd test
#sendpayment/yieldgen tests
 - python regtest.py
#wallet seed and password setup tests
 - python wallet-test.py
#TODO - possible to include tumbler-test? it takes much too long.
branches:
 only:
  - master
  - secp256k1

